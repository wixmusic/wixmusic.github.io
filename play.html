<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Music | Offline Player</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --accent-color: #facc15;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e5e7eb;
        }
        .text-accent {
            color: var(--accent-color);
        }
        .frosted-glass {
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 1rem;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="p-4 border-b border-gray-800 bg-black/70 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold text-white tracking-widest">Offline Player</a>
            <a href="index.html" class="px-4 py-2 text-sm font-semibold rounded-full bg-blue-500 hover:bg-blue-600 transition text-white">
                Back to Home
            </a>
        </div>
    </header>

    <!-- Player Section -->
    <section class="py-12 md:py-16">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Song Info -->
            <div class="mb-8 text-center">
                <h1 id="song-title" class="text-4xl md:text-5xl font-extrabold text-white mb-3">
                    Loading...
                </h1>
                <p id="song-artist" class="text-xl text-gray-400 mb-4">
                    ...
                </p>
                <div id="song-rank" class="inline-block px-4 py-2 rounded-full bg-blue-600/30 text-blue-400 text-sm font-semibold mb-4" style="display: none;">
                    <i class="fas fa-trophy mr-2"></i>Rank: <span id="rank-number"></span>
                </div>
            </div>

            <!-- YouTube Video Player -->
            <div class="frosted-glass p-6 rounded-2xl mb-8">
                <div class="video-container" id="video-container">
                    <iframe 
                        id="youtube-player"
                        src=""
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen
                        loading="lazy">
                    </iframe>
                </div>
                <!-- YouTube Search Fallback -->
                <div id="search-container" class="hidden text-center py-8">
                    <i class="fas fa-search text-4xl text-blue-400 mb-4"></i>
                    <p class="text-gray-300 mb-4">Search YouTube for the video:</p>
                    <a id="youtube-search-link" href="#" target="_blank" class="inline-block px-6 py-3 rounded-lg bg-red-600 hover:bg-red-500 text-white font-semibold transition">
                        <i class="fab fa-youtube mr-2"></i>Search on YouTube
                    </a>
                    <p class="text-gray-500 text-xs mt-4">Click the button above to find and play the correct video on YouTube</p>
                </div>
            </div>

            <!-- Related Actions -->
            <div class="grid grid-cols-1 md:grid-cols-1 gap-4 mb-8">
                <a href="index.html#charts" class="p-4 rounded-xl bg-gray-800 border border-gray-700 hover:border-blue-500 transition text-center">
                    <i class="fas fa-chart-line text-2xl text-blue-400 mb-2"></i>
                    <p class="text-sm font-semibold text-white">View Charts</p>
                </a>
            </div>

            <!-- Error Message (hidden by default) -->
            <div id="error-message" class="hidden p-6 rounded-xl bg-blue-900/30 border border-blue-500/50 text-center">
                <i class="fas fa-info-circle text-3xl text-blue-400 mb-3"></i>
                <p class="text-blue-400 font-semibold mb-2">Video Search Required</p>
                <p class="text-gray-400 text-sm mt-2">Use the YouTube search button above to find and play the video for this song.</p>
            </div>

        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
            <p>&copy; 2026 Offline Player. All rights reserved.</p>
            <div class="mt-4 space-x-4">
                <a href="index.html" class="hover:text-yellow-400 transition">Home</a>
                <a href="index.html#charts" class="hover:text-yellow-400 transition">Charts</a>
                <a href="legal/privacy-policy.html" class="hover:text-yellow-400 transition">Privacy Policy</a>
            </div>
        </div>
    </footer>

    <!-- JavaScript for Video Loading -->
    <script>
        // Note: YouTube doesn't allow direct embedding of search results.
        // We'll provide a search link that opens YouTube in a new tab
        // Users can then select and play the correct video from search results.

        // Get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const song = params.get('song') || '';
            const artist = params.get('artist') || '';
            const rank = params.get('rank') || '';
            
            // Debug logging
            console.log('URL Params:', { song, artist, rank });
            
            return {
                song: song,
                artist: artist,
                rank: rank
            };
        }

        // Normalize song title for matching
        function normalizeTitle(title) {
            return title.trim().replace(/\s+/g, ' ');
        }

        // Load video using YouTube search
        async function loadVideo() {
            const params = getUrlParams();
            // Decode URL parameters and normalize
            let songTitle = params.song ? decodeURIComponent(params.song) : '';
            songTitle = normalizeTitle(songTitle);
            const artist = params.artist ? decodeURIComponent(params.artist).trim() : '';
            const rank = params.rank;

            console.log('Parsed params:', { songTitle, artist, rank });

            // Update song info
            document.getElementById('song-title').textContent = songTitle || 'Unknown Song';
            document.getElementById('song-artist').textContent = artist || 'Unknown Artist';

            // Show rank if provided
            if (rank) {
                document.getElementById('song-rank').style.display = 'inline-block';
                document.getElementById('rank-number').textContent = '#' + rank;
            }

            if (!songTitle) {
                console.error('No song title provided');
                document.getElementById('video-container').style.display = 'none';
                document.getElementById('error-message').classList.remove('hidden');
                return;
            }

            // Build search query - optimized for finding official music videos
            const searchQuery = `${songTitle} ${artist || ''} official`.trim();
            const encodedQuery = encodeURIComponent(searchQuery);
            const searchUrl = `https://www.youtube.com/results?search_query=${encodedQuery}`;

            // Hide the YouTube iframe (since we don't have a specific video ID)
            const iframe = document.getElementById('youtube-player');
            iframe.style.display = 'none';
            
            // Show the search container
            const searchContainer = document.getElementById('search-container');
            const youtubeSearchLink = document.getElementById('youtube-search-link');
            
            searchContainer.classList.remove('hidden');
            youtubeSearchLink.href = searchUrl;
            youtubeSearchLink.innerHTML = `<i class="fab fa-youtube mr-2"></i>Search "${songTitle}"${artist ? ' by ' + artist : ''} on YouTube`;
            
            // Show info message
            document.getElementById('error-message').classList.remove('hidden');
            
            console.log('YouTube search URL:', searchUrl);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', loadVideo);
    </script>

</body>
</html>

